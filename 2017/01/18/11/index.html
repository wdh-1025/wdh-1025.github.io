<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>Android热修复-微信Tinker | Wdh&#39;s Blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="Android," />
  

  <meta name="description" content="写在前面正常情况下一旦线上版本出BUG时，这时候得改BUG，重新发布上线，用户重新下载安装，成本未免有点高；基于这种情况下很多热修复框架孕育而生，比较火的有：Andfix、HotFix等；本文旨在帮助没接触过Tinker的童鞋快速集成使用热修复；
本文环境官方地址SdkVersion 24gradle:2.2.0Tinker版本 1.7.5
集成Tinker在项目根目录的build.gradle中">
<meta property="og:type" content="article">
<meta property="og:title" content="Android热修复-微信Tinker">
<meta property="og:url" content="http://www.68blog.cn/2017/01/18/11/index.html">
<meta property="og:site_name" content="Wdh's Blog">
<meta property="og:description" content="写在前面正常情况下一旦线上版本出BUG时，这时候得改BUG，重新发布上线，用户重新下载安装，成本未免有点高；基于这种情况下很多热修复框架孕育而生，比较火的有：Andfix、HotFix等；本文旨在帮助没接触过Tinker的童鞋快速集成使用热修复；
本文环境官方地址SdkVersion 24gradle:2.2.0Tinker版本 1.7.5
集成Tinker在项目根目录的build.gradle中">
<meta property="og:image" content="http://ohci3aa1r.bkt.clouddn.com/tinker_1.png">
<meta property="og:image" content="http://ohci3aa1r.bkt.clouddn.com/tinker_2.png">
<meta property="og:image" content="http://ohci3aa1r.bkt.clouddn.com/tinker_3.jpg">
<meta property="og:updated_time" content="2017-01-18T09:24:19.383Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android热修复-微信Tinker">
<meta name="twitter:description" content="写在前面正常情况下一旦线上版本出BUG时，这时候得改BUG，重新发布上线，用户重新下载安装，成本未免有点高；基于这种情况下很多热修复框架孕育而生，比较火的有：Andfix、HotFix等；本文旨在帮助没接触过Tinker的童鞋快速集成使用热修复；
本文环境官方地址SdkVersion 24gradle:2.2.0Tinker版本 1.7.5
集成Tinker在项目根目录的build.gradle中">
<meta name="twitter:image" content="http://ohci3aa1r.bkt.clouddn.com/tinker_1.png">

  

  
    <link rel="icon" href="/images/favicon.ico">
  

  <link href="/css/styles.css?v=028c63b1" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?e89d0dea2a48a2818f673e4b1770e387";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">首页</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">首页</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            搜索
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#写在前面"><span class="toc-text">写在前面</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#本文环境"><span class="toc-text">本文环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#集成Tinker"><span class="toc-text">集成Tinker</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#测试修复BUG"><span class="toc-text">测试修复BUG</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-11" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">Android热修复-微信Tinker</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2017.01.18</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>Wdh</span>
        </span>
      

      


      

    </div>
  </header>

  <div class="article-content">
    
      <h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>正常情况下一旦线上版本出BUG时，这时候得改BUG，重新发布上线，用户重新下载安装，成本未免有点高；基于这种情况下很多热修复框架孕育而生，比较火的有：Andfix、HotFix等；本文旨在帮助没接触过Tinker的童鞋快速集成使用热修复；</p>
<h1 id="本文环境"><a href="#本文环境" class="headerlink" title="本文环境"></a>本文环境</h1><p><a href="https://github.com/Tencent/tinker" target="_blank" rel="external">官方地址</a><br>SdkVersion 24<br>gradle:2.2.0<br>Tinker版本 1.7.5</p>
<h1 id="集成Tinker"><a href="#集成Tinker" class="headerlink" title="集成Tinker"></a>集成Tinker</h1><p>在项目根目录的build.gradle中添加，例:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">      ···</div><div class="line">      classpath(<span class="string">'com.tencent.tinker:tinker-patch-gradle-plugin:1.7.5'</span>)</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>切换到module的build.gradle中添加，例:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">	···</div><div class="line">    provided(<span class="string">'com.tencent.tinker:tinker-android-anno:1.7.5'</span>)</div><div class="line">    compile(<span class="string">'com.tencent.tinker:tinker-android-lib:1.7.5'</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里我把打包签名的jks文件配置到gradle中，例：<br>因为我这里测试用到的是项目的签名文件，所以不方便给出，需要的自行生成，毕竟这是很简单的事；<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    ···</div><div class="line">    signingConfigs &#123;</div><div class="line">        release &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="function">storeFile <span class="title">file</span><span class="params">(<span class="string">"./keystore/app.jks"</span>)</span></span></div><div class="line">                storePassword "password"</div><div class="line">                keyAlias "alias"</div><div class="line">                keyPassword "password"</div><div class="line">            &#125; <span class="title">catch</span> <span class="params">(ex)</span> &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InvalidUserDataException(ex.toString())</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        debug &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="function">storeFile <span class="title">file</span><span class="params">(<span class="string">"./keystore/app.jks"</span>)</span></span></div><div class="line">                storePassword "password"</div><div class="line">                keyAlias "alias"</div><div class="line">                keyPassword "password"</div><div class="line">            &#125; <span class="title">catch</span> <span class="params">(ex)</span> &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InvalidUserDataException(ex.toString())</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>OK，到这里配置还是相对简单的，下面配置Tinker的gradle插件，官方demo配置还是比较麻烦的，看着就头晕，建议可以把先前的内容先复制出来，在拷贝官方demo的<a href="https://github.com/Tencent/tinker/blob/master/tinker-sample-android/app/build.gradle" target="_blank" rel="external">build.gradle</a>进去一点点修改；</p>
<p>如果还是懒得改，直接把下面内容复制到build.gradle最下面:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**-----------------------------------配置开始-----------------------------------*/</span></div><div class="line">def bakPath = file(<span class="string">"$&#123;buildDir&#125;/bakApk/"</span>)</div><div class="line"><span class="function">def <span class="title">gitSha</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        String gitRev = <span class="string">'11.2.3.5'</span></div><div class="line">        <span class="keyword">if</span> (gitRev == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GradleException(<span class="string">"can't get git rev, you should add git to system path or just input test value, such as 'testTinkerId'"</span>)</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> gitRev</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GradleException(<span class="string">"can't get git rev, you should add git to system path or just input test value, such as 'testTinkerId'"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">ext &#123;</div><div class="line">    tinkerEnabled = <span class="keyword">true</span></div><div class="line">    <span class="comment">//旧apk</span></div><div class="line">    tinkerOldApkPath = <span class="string">"$&#123;bakPath&#125;/app-debug-0118-15-13-26.apk"</span></div><div class="line">    <span class="comment">//旧包混淆文件</span></div><div class="line">    tinkerApplyMappingPath = <span class="string">"$&#123;bakPath&#125;/app-debug-1018-17-32-47-mapping.txt"</span></div><div class="line">    <span class="comment">//旧apk R文件</span></div><div class="line">    tinkerApplyResourcePath = <span class="string">"$&#123;bakPath&#125;/app-debug-0118-15-13-26-R.txt"</span></div><div class="line">    <span class="comment">//多渠道</span></div><div class="line">    tinkerBuildFlavorDirectory = <span class="string">"$&#123;bakPath&#125;/app-1018-17-32-47"</span></div><div class="line">&#125;</div><div class="line"><span class="function">def <span class="title">getOldApkPath</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> hasProperty(<span class="string">"OLD_APK"</span>) ? OLD_APK : ext.tinkerOldApkPath</div><div class="line">&#125;</div><div class="line"><span class="function">def <span class="title">getApplyMappingPath</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> hasProperty(<span class="string">"APPLY_MAPPING"</span>) ? APPLY_MAPPING : ext.tinkerApplyMappingPath</div><div class="line">&#125;</div><div class="line"><span class="function">def <span class="title">getApplyResourceMappingPath</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> hasProperty(<span class="string">"APPLY_RESOURCE"</span>) ? APPLY_RESOURCE : ext.tinkerApplyResourcePath</div><div class="line">&#125;</div><div class="line"><span class="function">def <span class="title">getTinkerIdValue</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> hasProperty(<span class="string">"TINKER_ID"</span>) ? TINKER_ID : gitSha()</div><div class="line">&#125;</div><div class="line"><span class="function">def <span class="title">buildWithTinker</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> hasProperty(<span class="string">"TINKER_ENABLE"</span>) ? TINKER_ENABLE : ext.tinkerEnabled</div><div class="line">&#125;</div><div class="line"><span class="function">def <span class="title">getTinkerBuildFlavorDirectory</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> ext.tinkerBuildFlavorDirectory</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (buildWithTinker()) &#123;</div><div class="line">    apply plugin: <span class="string">'com.tencent.tinker.patch'</span></div><div class="line">    tinkerPatch &#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * 基准apk包路径，也就是旧包路径</div><div class="line">         * */</div><div class="line">        oldApk = getOldApkPath()</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * 如果出现以下的情况，并且ignoreWarning为false，我们将中断编译。因为这些情况可能会导致编译出来的patch包</div><div class="line">         * 带来风险：</div><div class="line">         * 1. minSdkVersion小于14，但是dexMode的值为"raw";</div><div class="line">         * 2. 新编译的安装包出现新增的四大组件(Activity, BroadcastReceiver...)；</div><div class="line">         * 3. 定义在dex.loader用于加载补丁的类不在main dex中;</div><div class="line">         * 4. 定义在dex.loader用于加载补丁的类出现修改；</div><div class="line">         * 5. resources.arsc改变，但没有使用applyResourceMapping编译。</div><div class="line">         * */</div><div class="line">        ignoreWarning = <span class="keyword">false</span></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * 在运行过程中，我们需要验证基准apk包与补丁包的签名是否一致，是否需要为你签名</div><div class="line">         * */</div><div class="line">        useSign = <span class="keyword">true</span></div><div class="line">        buildConfig &#123;</div><div class="line">            <span class="comment">/**</span></div><div class="line">             * 可选参数；在编译新的apk时候，我们希望通过保持旧apk的proguard混淆方式，从而减少补丁包的大小。这个只</div><div class="line">             * 是推荐的，但设置applyMapping会影响任何的assemble编译。</div><div class="line">             * */</div><div class="line">            applyMapping = getApplyMappingPath()</div><div class="line">            <span class="comment">/**</span></div><div class="line">             * 可选参数；在编译新的apk时候，我们希望通过旧apk的R.txt文件保持ResId的分配，这样不仅可以减少补丁包的</div><div class="line">             * 大小，同时也避免由于ResId改变导致remote view异常。</div><div class="line">             * */</div><div class="line">            applyResourceMapping = getApplyResourceMappingPath()</div><div class="line">            <span class="comment">/**</span></div><div class="line">             * 在运行过程中，我们需要验证基准apk包的tinkerId是否等于补丁包的tinkerId。这个是决定补丁包能运行在哪些</div><div class="line">             * 基准包上面，一般来说我们可以使用git版本号、versionName等等。</div><div class="line">             * */</div><div class="line">            tinkerId = getTinkerIdValue()</div><div class="line">        &#125;</div><div class="line">        dex &#123;</div><div class="line">            <span class="comment">/**</span></div><div class="line">             * 只能是'raw'或者'jar'。</div><div class="line">             * 对于'raw'模式，我们将会保持输入dex的格式。</div><div class="line">             * 对于'jar'模式，我们将会把输入dex重新压缩封装到jar。如果你的minSdkVersion小于14，你必须选择‘jar’模式</div><div class="line">             * ，而且它更省存储空间，但是验证md5时比'raw'模式耗时()</div><div class="line">             * */</div><div class="line">            dexMode = <span class="string">"jar"</span></div><div class="line">            <span class="comment">/**</span></div><div class="line">             * 是否提前生成dex，而非合成的方式。这套方案即回退成Qzone的方案，对于需要使用加固或者多flavor打包(建</div><div class="line">             * 议使用其他方式生成渠道包)的用户可使用。但是这套方案需要插桩，会造成Dalvik下性能损耗以及Art补丁包可</div><div class="line">             * 能过大的问题，务必谨慎使用。另外一方面，这种方案在Android N之后可能会产生问题，建议过滤N之后的用户。</div><div class="line">             */</div><div class="line">            usePreGeneratedPatchDex = <span class="keyword">false</span></div><div class="line">            <span class="comment">/**</span></div><div class="line">             * 需要处理dex路径，支持*、?通配符，必须使用'/'分割。路径是相对安装包的，例如/assets/...</div><div class="line">             */</div><div class="line">            pattern = [<span class="string">"classes*.dex"</span>,</div><div class="line">                       <span class="string">"assets/secondary-dex-?.jar"</span>]</div><div class="line">            <span class="comment">/**</span></div><div class="line">             *     这一项非常重要，它定义了哪些类在加载补丁包的时候会用到。这些类是通过Tinker无法修改的类，也是一定要放在main dex的类。</div><div class="line">             这里需要定义的类有：</div><div class="line">             1. 你自己定义的Application类；</div><div class="line">             2. Tinker库中用于加载补丁包的部分类，即com.tencent.tinker.loader.*；</div><div class="line">             3. 如果你自定义了TinkerLoader，需要将它以及它引用的所有类也加入loader中；</div><div class="line">             4. 其他一些你不希望被更改的类，例如Sample中的BaseBuildInfo类。这里需要注意的是，这些类的直接引用类也</div><div class="line">             需要加入到loader中。或者你需要将这个类变成非preverify。</div><div class="line">             */</div><div class="line">            loader = [<span class="string">"com.tencent.tinker.loader.*"</span>,</div><div class="line">                      <span class="comment">//warning, you must change it with your application</span></div><div class="line">                      <span class="comment">//TODO 换成自己的Application</span></div><div class="line">                      <span class="string">"com.tinker.MyApplication"</span>,</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">        lib &#123;</div><div class="line">            <span class="comment">/**</span></div><div class="line">             * 需要处理lib路径，支持*、?通配符，必须使用'/'分割。与dex.pattern一致, 路径是相对安装包的，例如/assets/...</div><div class="line">             */</div><div class="line">            pattern = [<span class="string">"lib/armeabi/*.so"</span>]</div><div class="line">        &#125;</div><div class="line">        res &#123;</div><div class="line">            <span class="comment">/**</span></div><div class="line">             * 需要处理res路径，支持*、?通配符，必须使用'/'分割。与dex.pattern一致, 路径是相对安装包的，例如/assets/...，</div><div class="line">             * 务必注意的是，只有满足pattern的资源才会放到合成后的资源包。</div><div class="line">             */</div><div class="line">            pattern = [<span class="string">"res/*"</span>, <span class="string">"assets/*"</span>, <span class="string">"resources.arsc"</span>, <span class="string">"AndroidManifest.xml"</span>]</div><div class="line">            <span class="comment">/**</span></div><div class="line">             * 支持*、?通配符，必须使用'/'分割。若满足ignoreChange的pattern，在编译时会忽略该文件的新增、删除与修改。</div><div class="line">             * 最极端的情况，ignoreChange与上面的pattern一致，即会完全忽略所有资源的修改。</div><div class="line">             */</div><div class="line">            ignoreChange = [<span class="string">"assets/sample_meta.txt"</span>]</div><div class="line">            <span class="comment">/**</span></div><div class="line">             * 对于修改的资源，如果大于largeModSize，我们将使用bsdiff算法。这可以降低补丁包的大小，但是会增加合成</div><div class="line">             * 时的复杂度。默认大小为100kb</div><div class="line">             */</div><div class="line">            largeModSize = <span class="number">100</span></div><div class="line">        &#125;</div><div class="line">        packageConfig &#123;</div><div class="line">            <span class="comment">/**</span></div><div class="line">             * configField("key", "value"), 默认我们自动从基准安装包与新安装包的Manifest中读取tinkerId,并自动</div><div class="line">             * 写入configField。在这里，你可以定义其他的信息，在运行时可以通过TinkerLoadResult.getPackageConfigByName得到相应的数值。但是建议直接通过修改代码来实现，例如BuildConfig。</div><div class="line">             */</div><div class="line">            configField(<span class="string">"patchMessage"</span>, <span class="string">"tinker is sample to use"</span>)</div><div class="line">        &#125;</div><div class="line">        sevenZip &#123;</div><div class="line">            <span class="comment">/**</span></div><div class="line">             * 例如"com.tencent.mm:SevenZip:1.1.10"，将自动根据机器属性获得对应的7za运行文件，推荐使用</div><div class="line">             */</div><div class="line">            zipArtifact = <span class="string">"com.tencent.mm:SevenZip:1.1.10"</span></div><div class="line">        &#125;</div><div class="line">        <span class="comment">/**</span></div><div class="line">         *  文件名                              描述</div><div class="line">         *  patch_unsigned.apk                  没有签名的补丁包</div><div class="line">         *  patch_signed.apk                  签名后的补丁包</div><div class="line">         *  patch_signed_7zip.apk              签名后并使用7zip压缩的补丁包，也是我们通常使用的补丁包。但正式发布的时候，最好不要以.apk结尾，防止被运营商挟持。</div><div class="line">         *  log.txt                              在编译补丁包过程的控制台日志</div><div class="line">         *  dex_log.txt                          在编译补丁包过程关于dex的日志</div><div class="line">         *  so_log.txt                          在编译补丁包过程关于lib的日志</div><div class="line">         *  tinker_result                      最终在补丁包的内容，包括diff的dex、lib以及assets下面的meta文件</div><div class="line">         *  resources_out.zip                  最终在手机上合成的全量资源apk，你可以在这里查看是否有文件遗漏</div><div class="line">         *  resources_out_7z.zip              根据7zip最终在手机上合成的全量资源apk</div><div class="line">         *  tempPatchedDexes                  在Dalvik与Art平台，最终在手机上合成的完整Dex，我们可以在这里查看dex合成的产物。</div><div class="line">         *</div><div class="line">         *</div><div class="line">         * */</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * 获得所有渠道集合，并判断数量</div><div class="line">         */</div><div class="line">        List&lt;String&gt; flavors = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        project.android.productFlavors.each &#123; flavor -&gt;</div><div class="line">            flavors.add(flavor.name)</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">boolean</span> hasFlavors = flavors.size() &gt; <span class="number">0</span></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * bak apk and mapping</div><div class="line">         *  创建Task并执行文件操作</div><div class="line">         */</div><div class="line">        android.applicationVariants.all &#123; variant -&gt;</div><div class="line">            <span class="comment">/**</span></div><div class="line">             * task type, you want to bak</div><div class="line">             */</div><div class="line">            def taskName = variant.name</div><div class="line">            def date = <span class="keyword">new</span> Date().format(<span class="string">"MMdd-HH-mm-ss"</span>)</div><div class="line"></div><div class="line">            tasks.all &#123;</div><div class="line">                <span class="keyword">if</span> (<span class="string">"assemble$&#123;taskName.capitalize()&#125;"</span>.equalsIgnoreCase(it.name)) &#123;</div><div class="line"></div><div class="line">                    it.doLast &#123;</div><div class="line">                        copy &#123;</div><div class="line">                            def fileNamePrefix = <span class="string">"$&#123;project.name&#125;-$&#123;variant.baseName&#125;"</span></div><div class="line">                            def newFileNamePrefix = hasFlavors ? <span class="string">"$&#123;fileNamePrefix&#125;"</span> : <span class="string">"$&#123;fileNamePrefix&#125;-$&#123;date&#125;"</span></div><div class="line">                            def destPath = hasFlavors ? file(<span class="string">"$&#123;bakPath&#125;/$&#123;project.name&#125;-$&#123;date&#125;/$&#123;variant.flavorName&#125;"</span>) : bakPath</div><div class="line">                            from variant.outputs.outputFile</div><div class="line">                            into destPath</div><div class="line">                            rename &#123; String fileName -&gt;</div><div class="line">                                fileName.replace(<span class="string">"$&#123;fileNamePrefix&#125;.apk"</span>, <span class="string">"$&#123;newFileNamePrefix&#125;.apk"</span>)</div><div class="line">                            &#125;</div><div class="line">                            from <span class="string">"$&#123;buildDir&#125;/outputs/mapping/$&#123;variant.dirName&#125;/mapping.txt"</span></div><div class="line">                            into destPath</div><div class="line">                            rename &#123; String fileName -&gt;</div><div class="line">                                fileName.replace(<span class="string">"mapping.txt"</span>, <span class="string">"$&#123;newFileNamePrefix&#125;-mapping.txt"</span>)</div><div class="line">                            &#125;</div><div class="line">                            from <span class="string">"$&#123;buildDir&#125;/intermediates/symbols/$&#123;variant.dirName&#125;/R.txt"</span></div><div class="line">                            into destPath</div><div class="line">                            rename &#123; String fileName -&gt;</div><div class="line">                                fileName.replace(<span class="string">"R.txt"</span>, <span class="string">"$&#123;newFileNamePrefix&#125;-R.txt"</span>)</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * 如果有渠道则进行多渠道打包</div><div class="line">         */</div><div class="line">        project.afterEvaluate &#123;</div><div class="line">            <span class="comment">//sample use for build all flavor for one time</span></div><div class="line">            <span class="keyword">if</span> (hasFlavors) &#123;</div><div class="line">                task(tinkerPatchAllFlavorRelease) &#123;</div><div class="line">                    group = <span class="string">'tinker'</span></div><div class="line">                    def originOldPath = getTinkerBuildFlavorDirectory()</div><div class="line">                    <span class="keyword">for</span> (String flavor : flavors) &#123;</div><div class="line">                        def tinkerTask = tasks.getByName(<span class="string">"tinkerPatch$&#123;flavor.capitalize()&#125;Release"</span>)</div><div class="line">                        dependsOn tinkerTask</div><div class="line">                        def preAssembleTask = tasks.getByName(<span class="string">"process$&#123;flavor.capitalize()&#125;ReleaseManifest"</span>)</div><div class="line">                        preAssembleTask.doFirst &#123;</div><div class="line">                            String flavorName = preAssembleTask.name.substring(<span class="number">7</span>, <span class="number">8</span>).toLowerCase() + preAssembleTask.name.substring(<span class="number">8</span>, preAssembleTask.name.length() - <span class="number">15</span>)</div><div class="line">                            project.tinkerPatch.oldApk = <span class="string">"$&#123;originOldPath&#125;/$&#123;flavorName&#125;/$&#123;project.name&#125;-$&#123;flavorName&#125;-release.apk"</span></div><div class="line">                            project.tinkerPatch.buildConfig.applyMapping = <span class="string">"$&#123;originOldPath&#125;/$&#123;flavorName&#125;/$&#123;project.name&#125;-$&#123;flavorName&#125;-release-mapping.txt"</span></div><div class="line">                            project.tinkerPatch.buildConfig.applyResourceMapping = <span class="string">"$&#123;originOldPath&#125;/$&#123;flavorName&#125;/$&#123;project.name&#125;-$&#123;flavorName&#125;-release-R.txt"</span></div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                task(tinkerPatchAllFlavorDebug) &#123;</div><div class="line">                    group = <span class="string">'tinker'</span></div><div class="line">                    def originOldPath = getTinkerBuildFlavorDirectory()</div><div class="line">                    <span class="keyword">for</span> (String flavor : flavors) &#123;</div><div class="line">                        def tinkerTask = tasks.getByName(<span class="string">"tinkerPatch$&#123;flavor.capitalize()&#125;Debug"</span>)</div><div class="line">                        dependsOn tinkerTask</div><div class="line">                        def preAssembleTask = tasks.getByName(<span class="string">"process$&#123;flavor.capitalize()&#125;DebugManifest"</span>)</div><div class="line">                        preAssembleTask.doFirst &#123;</div><div class="line">                            String flavorName = preAssembleTask.name.substring(<span class="number">7</span>, <span class="number">8</span>).toLowerCase() + preAssembleTask.name.substring(<span class="number">8</span>, preAssembleTask.name.length() - <span class="number">13</span>)</div><div class="line">                            project.tinkerPatch.oldApk = <span class="string">"$&#123;originOldPath&#125;/$&#123;flavorName&#125;/$&#123;project.name&#125;-$&#123;flavorName&#125;-debug.apk"</span></div><div class="line">                            project.tinkerPatch.buildConfig.applyMapping = <span class="string">"$&#123;originOldPath&#125;/$&#123;flavorName&#125;/$&#123;project.name&#125;-$&#123;flavorName&#125;-debug-mapping.txt"</span></div><div class="line">                            project.tinkerPatch.buildConfig.applyResourceMapping = <span class="string">"$&#123;originOldPath&#125;/$&#123;flavorName&#125;/$&#123;project.name&#125;-$&#123;flavorName&#125;-debug-R.txt"</span></div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**-----------------------------------配置结束-----------------------------------*/</span></div></pre></td></tr></table></figure></p>
<p>注意tinkerId目前暂时是写死的；<br>新建SampleApplicarion文件继承DefaultApplicationLike，例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@DefaultLifeCycle</span>(application = <span class="string">"com.tinker.MyApplication"</span>,flags = ShareConstants.TINKER_ENABLE_ALL)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleApplicarion</span> <span class="keyword">extends</span> <span class="title">DefaultApplicationLike</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SampleApplicarion</span><span class="params">(Application application, <span class="keyword">int</span> tinkerFlags, <span class="keyword">boolean</span> tinkerLoadVerifyFlag, <span class="keyword">long</span> applicationStartElapsedTime, <span class="keyword">long</span> applicationStartMillisTime, Intent tinkerResultIntent, Resources[] resources, ClassLoader[] classLoader, AssetManager[] assetManager)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(application, tinkerFlags, tinkerLoadVerifyFlag, applicationStartElapsedTime, applicationStartMillisTime, tinkerResultIntent, resources, classLoader, assetManager);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBaseContextAttached</span><span class="params">(Context base)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onBaseContextAttached(base);</div><div class="line">        TinkerInstaller.install(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@TargetApi</span>(Build.VERSION_CODES.ICE_CREAM_SANDWICH)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerActivityLifecycleCallbacks</span><span class="params">(Application.ActivityLifecycleCallbacks callback)</span> </span>&#123;</div><div class="line">        getApplication().registerActivityLifecycleCallbacks(callback);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><font color="red">上面的application=”你的包名.MyApplication”并在上一步将dex中的loader修改为:</font><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">loader = [<span class="string">"com.tencent.tinker.loader.*"</span>,<span class="string">"你的包名.MyApplication"</span>,]</div></pre></td></tr></table></figure></p>
<p>记得在AndroidManifest.xml中添加：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.MOUNT_UNMOUNT_FILESYSTEMS"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">application</span></span></div><div class="line">    <span class="attr">android:name</span>=<span class="string">".MyApplication"</span></div><div class="line">    <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></div><div class="line">    <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></div><div class="line">    <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></div><div class="line">    <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span></div><div class="line">    <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</div><div class="line">    ···</div><div class="line">    ···</div><div class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>OK,到这里就算配置完成了，配置完了当然要测试了；</p>
<h1 id="测试修复BUG"><a href="#测试修复BUG" class="headerlink" title="测试修复BUG"></a>测试修复BUG</h1><p>在MainActivity中添加完初始代码后点击Build-&gt;Build APK生成APK；<br><img src="http://ohci3aa1r.bkt.clouddn.com/tinker_1.png" alt="描述"><br>将outputs里面的apk拷贝出去安装在手机上，然后打开的build.radle修改ext，其它不管，例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ext &#123;</div><div class="line">    tinkerEnabled = <span class="keyword">true</span></div><div class="line">    <span class="comment">//旧apk</span></div><div class="line">    tinkerOldApkPath = <span class="string">"$&#123;bakPath&#125;/app-debug-0118-16-38-14.apk"</span></div><div class="line">    ···</div><div class="line">    <span class="comment">//旧apk R文件</span></div><div class="line">    tinkerApplyResourcePath = <span class="string">"$&#123;bakPath&#125;/app-debug-0118-16-38-14-R.txt"</span></div><div class="line">	···</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后切换到MainActivity修复你的bug，这里我添加了一张资源图片(刚好同事在玩支付宝集福，就P了张有9张”敬业福”的图片骗他们，哈哈)，修复好代码后点击右侧Gradle找到:app-&gt;Tasks-&gt;tinker，然后双击tinkerPatchDebug后会在outputs下面生成tinkerPatch文件夹，其中的patch_signed_7zip.apk就是你需要的补丁：<br><img src="http://ohci3aa1r.bkt.clouddn.com/tinker_2.png" alt="描述"><br>将patch_signed_7zip.apk文件放到你设置的SD卡目录，调用Tinker加载补丁，例:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">TinkerInstaller.onReceiveUpgradePatch(getApplicationContext(), patchPath);</div></pre></td></tr></table></figure></p>
<p>如果加载成功下面的tinker.isTinkerLoaded()返回的是true，例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Tinker tinker = Tinker.with(getApplicationContext());</div><div class="line"><span class="keyword">boolean</span> isLoadSuccess = tinker.isTinkerLoaded();</div><div class="line"><span class="keyword">if</span>(isLoadSuccess)&#123;</div><div class="line">	Log.i(TAG,<span class="string">"success"</span>);</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">	Log.i(TAG,<span class="string">"error"</span>);	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>OK,加载补丁前点击”SHOW”会抛出空指针异常，修复完后点击”SHOW”，BUG解决：<br><img src="http://ohci3aa1r.bkt.clouddn.com/tinker_3.jpg" width="35%" height="35%"></p>
<p><a href="https://github.com/wdh-1025/WX-Tinker" target="_blank" rel="external">DEMO地址</a></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>Tinker是腾讯出品，微信在用，我想兼容性应该不会差到哪去，相比其他热修复框架，这是个很大的优点，而且Tinker支持类替换、so库及资源的替换等，如果在相对稳定的情况下，使用Tinker用于线上产品的功能升级应该没什么问题，其它更高级的用法自行深入研究；</p>

    
  </div>
</article>

</div>


  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">支持一下</span>
      <div class="donation-body">
        <div class="tip text-center">扫一扫，支持一下</div>
        <ul class="theme.donation.items.length">
        
          <li class="item">
            <img src="/images/qr-wechat.png" alt="">
          </li>
        
          <li class="item">
            <img src="/images/qr-alipay.png" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>




  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              搜索
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    
  <section class="duoshuo-comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="http://www.68blog.cn/2017/01/18/11/index.html" data-title="Android热修复-微信Tinker" data-url="http://www.68blog.cn/2017/01/18/11/index.html"></div>
    <!-- 多说评论框 end -->
  </section>




  <script type="text/javascript">
  var duoshuoQuery = {short_name:"wdh-1025"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>


  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
